function fn.digHello(id) 
 fn.send(tonumber(id),"IAm "..os.getComputerID())
end

function fn.digRegister()
 local ans = fn.all('digHello',os.getComputerID())
 local k,v
 maxDrone = 0
 for k,v in pairs(ans) do
  maxDrone = maxDrone +1
 end
 print('register count = ', maxDrone)
end


function fn.digWait()
 local k,v,c,tmp=0,0,0,echo_recv
 echo_recv = false
 while true do
  sleep(5)
  local ans = fn.all('digHello '..os.getComputerID())
  c = 0
  for k,v in pairs(ans) do
   c = c+1
  end
  if c == maxDrone then
   echo_recv = tmp
   return
  end  
 end
end

function fn.digBase()
 fn.all('digPlusBase')
 fn.digPlusBase()
 fn.digWait()
end

function fn.digHome()
 fn.all('digPlusHome')
 fn.digWait()
end

function fn.digRun()
 fn.all('digPlusRun')
 fn.digWait()
end

function fn.digNext()
 fn.all('digPlusNext')
 fn.go(5,0,0,'N')
 fn.digWait()
end

function fn.digDropAll()
 return fn.digDrop(true)
end

function fn.digDrop(all)
 fn.tryDigUp()
 turtle.select(conf.placeSlot)
 turtle.placeUp()
 if all == nil then
  fn.all('digPlusDrop')
 else
  fn.all('digPlusDropAll')
 end
 fn.digPlusDrop(4, turtle.dropUp)
 fn.digWait()
end

function fn.digs()
 while true do
 fn.digBase()
 fn.digHome()
 fn.digRun()
 fn.digNext()
 fn.digDrop()
 end
end

base={}
function fn.getBase()
	local m,d,loc = nil,0,nil
	while m==nill do
		status('locate base '..os.time())
		sleep(math.random(1,5))
		rednet.broadcast("BASE")
		BaseID,m,d=rednet.receive(2) 
		--print_(BaseID,m,d)
		if m~= nil then
			loc=textutils.unserialize(m)
			if loc == nil then m=nil 
			elseif loc[4] ~= "base" then m=nil end
		end
	end
	base={}
	base.x=loc[1]
	base.y=loc[2]
	base.z=loc[3]
	base.id=BaseID
	return b
end